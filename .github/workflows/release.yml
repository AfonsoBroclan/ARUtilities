# This workflow will build the package and run its tests
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-swift

name: Release

on:
  push:
    branches: [ "main" ]

env:
  APP_VERSION: "0.2.0" # Change accordingly
  
jobs:
  build-test:
    uses: ./.github/workflows/buildTest.yml

  release:
    needs: build-test
    runs-on: macos-latest
    permissions:
      contents: write

    steps:
    - uses: actions/checkout@v4
    - name: Create Tag
      run: |
        echo "üè∑Ô∏è Creating tag for $APP_VERSION..."
        if git ls-remote --tags origin | grep -q "refs/tags/$APP_VERSION$"; then
          echo "‚ö†Ô∏è Tag $APP_VERSION already exists, skipping..."
          exit 0
        fi
        git tag "$APP_VERSION"
        git push origin "$APP_VERSION"
        echo "üè∑Ô∏è Tag $APP_VERSION created and pushed!"
